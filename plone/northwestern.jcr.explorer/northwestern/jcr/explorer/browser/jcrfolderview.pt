<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="northwestern.jcr.explorer">
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main"
           tal:define="text context/description;">

        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading">
            <span metal:use-macro="python:context.widget('title', mode='view')" />
        </h1>

        <div tal:replace="structure provider:plone.belowcontenttitle" />

        <div STYLE="color: red" class="documentDescription">
            <span metal:use-macro="python:context.widget('description', mode='view')" />
        </div>

        <div tal:replace="structure provider:plone.abovecontentbody" />

		<!--
        <p tal:condition="python: not text and is_editable"
           i18n:translate="no_body_text"
           class="discreet">
            This item does not have any body text, click the edit tab to change it.
        </p>
		-->
		  
		<!--
        <div tal:condition="text" metal:use-macro="python:context.widget('text', mode='view')" />
		-->

		  <!--
		  <input type="button" value="Update" class="buttonDhide" />
		  -->

		  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
		  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

          <!--
		  <form id="repository_synch_form" name="repository_synch_form"
		  action="synchToRepository" method="post" enctype="multipart/form-data"
		  tal:attributes="action string:${here/absolute_url}/synchToRepository">
		  <input class="form-button" type="submit" name="form.button.synch"
		  value="Synchronize to Repository" />
		  
		  </form>
          -->
          
		  <input type="button" value="Synchronize to Repository" class="form-button" />
          
		  <span class="contentToChange"></span>
		  <div class="progressbar" width="50%"></div>

          
		  <script>
          function sendRequest(){
        /* This requests the url "msgsrv.php"
        When it complete (or errors)*/
        $.getJSON("http://localhost:7070/Plone/Members/admin/content/synchToRepository", {}, function(){

          });
          
        };

function waitForMsg(){
        /* This requests the url "msgsrv.php"
        When it complete (or errors)*/
        $.ajax({
            type: "GET",
            url: "http://localhost:7070/Plone/Members/admin/content/getProgress",

            async: true, /* If set to non-async, browser shows page as "Loading.."*/
            cache: false,
            timeout:50000, /* Timeout in ms */

            success: function(data){ /* called when request to barge.php completes */
		        // $("span.contentToChange").empty();
		        // $("span.contentToChange").append(data);
		        $("span.contentToChange").load("http://localhost:7070/Plone/Members/admin/content/getMessage");
		        var p = parseInt(data);
		        $("div.progressbar").progressbar("option", "value", p);
		        if (p != 100) {
                setTimeout(
                    'waitForMsg()', /* Request next message */
                    1000 /* ..after 1 seconds */
                );
		        }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown){
		        $("span.contentToChange").empty();
                setTimeout(
                    'waitForMsg()', /* Try again after.. */
                    "15000"); /* milliseconds (15seconds) */
            },
        });
    };
		  
		  // Code for example D
$("input.buttonDhide").click(function(){
		  // $("div.contentToChange").find("p.thirdparagraph").empty();
		  $("span.contentToChange").load("http://localhost:7070/Plone/Members/admin/content/getMessage");
		  });
		  
$("input.form-button").click(function(){
		  $("div.progressbar").progressbar({ value: 0 });
          // waitForMsg();
          sendRequest();
		  waitForMsg(); /* Start the inital request */
		  });

		  </script>

		  
		  
		  
        <tal:areas condition="view/have_jcr_folders">
            <h2 i18n:translate="title_filmfolder_subareas">Folders</h2>
            <dl>
                <tal:block repeat="area view/jcr_folders">
                    <dt>
                        <a tal:attributes="href area/url"
                           tal:content="area/title">Area Title</a>
                    </dt>
                    <dd tal:content="area/description" />
                </tal:block>
            </dl>
        </tal:areas>
        
        <tal:files condition="view/have_jcr_files">
            <h2 i18n:translate="title_filmfolder_subareas">Files</h2>
            <dl>
                <tal:block repeat="file view/jcr_files">
                    <dt>
                        <a tal:attributes="href file/url"
                           tal:content="file/title">File title</a>
                    </dt>
					<dd/>
					<!--
                    <dd tal:content="file/address" />
					-->
                </tal:block>
            </dl>
        </tal:files>

        <div metal:use-macro="context/document_relateditems/macros/relatedItems">
            show related items if they exist
        </div>
    
        <div tal:replace="structure provider:plone.belowcontentbody" />

    </tal:main-macro>
</metal:main>

</body>
</html>
